---
interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{title} - FashionStore Admin</title>
  <style is:global>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #f3f4f6;
    }
    /* Mostrar logo en ambas pantallas */
    .sidebar-logo {
      display: flex;
    }
  </style>
</head>
<body>
  <div class="flex h-screen bg-gray-100">
    <!-- Sidebar -->
    <aside class="w-64 bg-gray-900 text-white shadow-lg fixed h-screen overflow-y-auto">
      <!-- Logo -->
      <div class="sidebar-logo p-6 border-b border-gray-800">
        <a href="/admin/dashboard" class="flex items-center gap-2 hover:opacity-80 transition">
          <div class="w-10 h-10 bg-[#00aa45] rounded-lg flex items-center justify-center font-bold text-white">FS</div>
          <div>
            <div class="font-black text-lg">Fashion<span class="text-[#00aa45]">Store</span></div>
            <div class="text-xs text-gray-400">Admin</div>
          </div>
        </a>
      </div>

      <!-- User Info -->
      <div class="px-6 py-4 border-b border-gray-800">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-[#00aa45] rounded-full flex items-center justify-center font-bold text-white">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
          </div>
          <div>
            <div class="text-sm font-semibold" id="sidebar-username">Admin</div>
            <div class="text-xs text-gray-400">Administrador</div>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="px-3 py-6 space-y-2">
        <!-- Dashboard -->
        <a href="/admin/dashboard?section=dashboard" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="dashboard">
          <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
            <path d="M3 13h2v8H3zm4-8h2v16H7zm4-2h2v18h-2zm4 4h2v14h-2zm4-2h2v16h-2z"/>
          </svg>
          <span class="font-semibold">Dashboard</span>
        </a>

        <!-- Productos -->
        <div class="pt-2">
          <h3 class="px-4 py-2 text-xs font-bold text-gray-400 uppercase tracking-wider">Gestión</h3>
          <a href="/admin/dashboard?section=productos" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="productos">
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-0.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l0.03-.12 0.9-1.63h7.45c0.75 0 1.41-.41 1.75-1.03l3.58-6.49c0.08-.14 0.12-.31 0.12-.48 0-.55-.45-1-1-1H5.21l-0.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s0.89 2 1.99 2 2-0.9 2-2-0.9-2-2-2z"/>
            </svg>
            <span class="font-semibold">Productos</span>
          </a>
          <a href="/admin/dashboard?section=categorias" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="categorias">
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M10 4H4c-1.1 0-2 .9-2 2v6h6V4zm0 10H4v6c0 1.1.9 2 2 2h6v-8zm10-10h-6v6h8V6c0-1.1-.9-2-2-2zm0 10h-8v8h6c1.1 0 2-.9 2-2v-6z"/>
            </svg>
            <span class="font-semibold">Categorías</span>
          </a>
          <a href="/admin/dashboard?section=marcas" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="marcas">
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12.5 1.5h-6l-3 3.5v14.5h12v-14.5l-3-3.5zm-.5 17h-8v-13h4l2-2h4l2 2h4v13h-8z"/>
            </svg>
            <span class="font-semibold">Marcas</span>
          </a>
        </div>

        <!-- Pedidos y Ventas -->
        <div class="pt-2">
          <h3 class="px-4 py-2 text-xs font-bold text-gray-400 uppercase tracking-wider">Ventas</h3>
          <a href="/admin/dashboard?section=pedidos" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="pedidos">
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-0.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l0.03-.12 0.9-1.63h7.45c0.75 0 1.41-.41 1.75-1.03l3.58-6.49c0.08-.14 0.12-.31 0.12-.48 0-.55-.45-1-1-1H5.21l-0.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s0.89 2 1.99 2 2-0.9 2-2-0.9-2-2-2z"/>
            </svg>
            <span class="font-semibold">Pedidos</span>
          </a>
          <a href="/admin/dashboard?section=envios" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="envios">
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M18 18.5a1.5 1.5 0 01-1.5-1.5 1.5 1.5 0 011.5-1.5 1.5 1.5 0 011.5 1.5 1.5 1.5 0 01-1.5 1.5m1.5-9l1.96 2.5H17V9.5m-11 9a1.5 1.5 0 01-1.5-1.5 1.5 1.5 0 011.5-1.5 1.5 1.5 0 011.5 1.5 1.5 1.5 0 01-1.5 1.5M20 4H4c-1.1 0-2 .9-2 2v11h2a3 3 0 013 3 3 3 0 013-3h6a3 3 0 013 3 3 3 0 013-3h2V6c0-1.1-.9-2-2-2zm0 9h-6V6h6v7z"/>
            </svg>
            <span class="font-semibold">Envíos</span>
          </a>
          <a href="/admin/dashboard?section=devoluciones" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="devoluciones">
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M7 10l5 5 5-5z"/>
            </svg>
            <span class="font-semibold">Devoluciones</span>
          </a>
          <a href="/admin/dashboard?section=resenas" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="resenas">
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2l-2.81 6.63L2 9.24l5.46 4.73L5.82 21 12 17.27z"/>
            </svg>
            <span class="font-semibold">Reseñas</span>
          </a>
        </div>

        <!-- Marketing -->
        <div class="pt-2">
          <h3 class="px-4 py-2 text-xs font-bold text-gray-400 uppercase tracking-wider">Marketing</h3>
          <a href="/admin/dashboard?section=cupones" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="cupones">
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M21.5.5H2.5C1.12 1.62.5 2.5.5 4v16c0 1.5.62 2.38 2 3.5h19c1.38-1.12 2-2 2-3.5V4c0-1.5-.62-2.38-2-3.5zm-2 17h-15v-2h15v2zm0-4h-15v-2h15v2zm0-4h-15v-2h15v2z"/>
            </svg>
            <span class="font-semibold">Cupones</span>
          </a>
          <a href="/admin/dashboard?section=campanas" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="campanas">
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M21 7c0-.55-.45-1-1-1h-1V4c0-.55-.45-1-1-1h-2c-.55 0-1 .45-1 1v2h-6V4c0-.55-.45-1-1-1H7c-.55 0-1 .45-1 1v2H4c-.55 0-1 .45-1 1v14c0 .55.45 1 1 1h16c.55 0 1-.45 1-1V7z"/>
            </svg>
            <span class="font-semibold">Campañas</span>
          </a>
        </div>

        <!-- Reportes -->
        <div class="pt-2">
          <h3 class="px-4 py-2 text-xs font-bold text-gray-400 uppercase tracking-wider">Reportes</h3>
          <a href="/admin/dashboard?section=ventas" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="ventas">
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2V17zm4 0h-2V7h2V17zm4 0h-2v-4h2V17z"/>
            </svg>
            <span class="font-semibold">Ventas</span>
          </a>
          <a href="/admin/dashboard?section=inventario" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="inventario">
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
            </svg>
            <span class="font-semibold">Inventario</span>
          </a>
        </div>

        <!-- Configuración -->
        <div class="pt-2">
          <h3 class="px-4 py-2 text-xs font-bold text-gray-400 uppercase tracking-wider">Sistema</h3>
          <a href="/admin/dashboard?section=configuracion" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200" data-page="configuracion">
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.64l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.22-.07.5.12.64l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.64l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.5-.12-.64l-2.03-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
            </svg>
            <span class="font-semibold">Configuración</span>
          </a>
        </div>
      </nav>

      <!-- Logout Button -->
      <div class="px-3 py-6 border-t border-gray-800 mt-auto">
        <button
          onclick="handleLogout()"
          class="w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-red-600 hover:bg-red-700 transition-all duration-200 font-semibold"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
          </svg>
          <span>Cerrar Sesión</span>
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 ml-64 flex flex-col overflow-hidden">
      <!-- Top Bar -->
      <header class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50">
        <div class="px-8 py-4 flex justify-between items-center">
        </div>
      </header>

      <!-- Content Area -->
      <main class="flex-1 overflow-auto p-8">
        <slot />
      </main>
    </div>
  </div>

  <script>
    // Verificar autenticación
    document.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('admin_token');
      const username = localStorage.getItem('admin_user');
      
      if (!token || !username) {
        window.location.href = '/admin-secret-login';
      } else {
        // Mostrar username
        const usernameElements = document.querySelectorAll('[id*="username"]');
        usernameElements.forEach(el => {
          if (el.id.includes('sidebar') || el.id.includes('user')) {
            el.textContent = username;
          }
        });
      }
    });

    // Logout
    function handleLogout() {
      if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
        localStorage.removeItem('admin_token');
        localStorage.removeItem('admin_user');
        window.location.href = '/admin-secret-login';
      }
    }

    // Resaltar página activa
    function setActivePage(pageName) {
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('bg-gray-800', 'text-[#00aa45]');
        if (link.getAttribute('data-page') === pageName) {
          link.classList.add('bg-gray-800');
        }
      });
    }

    // Hacer setActivePage global
    window.setActivePage = setActivePage;

    // Interceptar clicks en los links de navegación para actualizar estado sin recargar
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const href = link.getAttribute('href');
        if (href) {
          window.history.pushState({}, '', href);
          // Disparar evento personalizado para que AdminDashboard se entere
          window.dispatchEvent(new Event('admin-nav-change'));
        }
      });
    });
  </script>
</body>
</html>
