---
interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title} - FashionStore Admin</title>
    <style is:global>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background-color: #f3f4f6;
      }
      /* Mostrar logo en ambas pantallas */
      .sidebar-logo {
        display: flex;
      }
      /* Ocultar barra de desplazamiento */
      ::-webkit-scrollbar {
        width: 0;
        height: 0;
      }
      ::-webkit-scrollbar-track {
        display: none;
      }
      ::-webkit-scrollbar-thumb {
        display: none;
      }
      /* Firefox */
      * {
        scrollbar-width: none;
      }
    </style>
  </head>
  <body>
    <div class="flex h-screen bg-gray-100 overflow-hidden">
      <!-- Overlay para móvil -->
      <div
        id="mobile-overlay"
        class="hidden fixed inset-0 top-16 bg-black bg-opacity-50 z-40 md:hidden"
      >
      </div>

      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="w-64 bg-gray-900 text-white shadow-lg fixed md:relative top-16 md:top-0 h-[calc(100vh-64px)] md:h-screen overflow-y-auto transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-50 flex flex-col border-r border-gray-800 flex-shrink-0"
      >
        <!-- Branding (Solo PC) -->
        <div class="hidden md:flex p-6 border-b border-gray-800">
          <a
            href="/admin/dashboard"
            class="flex items-center gap-3 hover:opacity-80 transition"
          >
            <img src="/admin-logo.png" alt="Logo" class="w-8 h-8 rounded-lg" />
            <div class="flex flex-col">
              <span class="font-black italic text-xl leading-tight"
                >Fashion<span class="text-[#00aa45]">Store</span></span
              >
              <span
                class="text-[10px] text-gray-400 font-mono tracking-widest uppercase"
                >Admin</span
              >
            </div>
          </a>
        </div>

        <!-- Navigation -->
        <nav class="px-3 py-6 space-y-1 flex-1">
          <!-- Dashboard -->
          <a
            href="/admin/dashboard?section=dashboard"
            class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200"
            data-page="dashboard"
          >
            <svg
              class="w-5 h-5 text-gray-400"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                d="M3 13h2v8H3zm4-8h2v16H7zm4-2h2v18h-2zm4 4h2v14h-2zm4-2h2v16h-2z"
              ></path>
            </svg>
            <span class="font-semibold text-sm">Dashboard</span>
          </a>

          <!-- Gestión Group -->
          <div class="pt-4 pb-2">
            <h3
              class="px-4 text-[10px] font-bold text-gray-500 uppercase tracking-[2px] mb-2"
            >
              Gestión
            </h3>
            <a
              href="/admin/dashboard?section=productos"
              class="nav-link flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-gray-800 transition-all duration-200 group"
              data-page="productos"
            >
              <div
                class="w-1.5 h-1.5 rounded-full bg-gray-600 group-hover:bg-[#00aa45]"
              >
              </div>
              <span class="font-medium text-sm">Productos</span>
            </a>
            <a
              href="/admin/dashboard?section=categorias"
              class="nav-link flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-gray-800 transition-all duration-200 group"
              data-page="categorias"
            >
              <div
                class="w-1.5 h-1.5 rounded-full bg-gray-600 group-hover:bg-[#00aa45]"
              >
              </div>
              <span class="font-medium text-sm">Categorías</span>
            </a>
            <a
              href="/admin/dashboard?section=marcas"
              class="nav-link flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-gray-800 transition-all duration-200 group"
              data-page="marcas"
            >
              <div
                class="w-1.5 h-1.5 rounded-full bg-gray-600 group-hover:bg-[#00aa45]"
              >
              </div>
              <span class="font-medium text-sm">Marcas</span>
            </a>
          </div>

          <!-- Ventas Group -->
          <div class="pt-2 pb-2">
            <h3
              class="px-4 text-[10px] font-bold text-gray-500 uppercase tracking-[2px] mb-2"
            >
              Ventas
            </h3>
            <a
              href="/admin/dashboard?section=pedidos"
              class="nav-link flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-gray-800 transition-all duration-200 group"
              data-page="pedidos"
            >
              <div
                class="w-1.5 h-1.5 rounded-full bg-gray-600 group-hover:bg-[#00aa45]"
              >
              </div>
              <span class="font-medium text-sm">Pedidos</span>
            </a>
            <a
              href="/admin/dashboard?section=devoluciones"
              class="nav-link flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-gray-800 transition-all duration-200 group"
              data-page="devoluciones"
            >
              <div
                class="w-1.5 h-1.5 rounded-full bg-gray-600 group-hover:bg-[#00aa45]"
              >
              </div>
              <span class="font-medium text-sm">Devoluciones</span>
            </a>
            <a
              href="/admin/dashboard?section=resenas"
              class="nav-link flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-gray-800 transition-all duration-200 group"
              data-page="resenas"
            >
              <div
                class="w-1.5 h-1.5 rounded-full bg-gray-600 group-hover:bg-[#00aa45]"
              >
              </div>
              <span class="font-medium text-sm">Reseñas</span>
            </a>
          </div>

          <!-- Marketing Group -->
          <div class="pt-2 pb-2">
            <h3
              class="px-4 text-[10px] font-bold text-gray-500 uppercase tracking-[2px] mb-2"
            >
              Marketing
            </h3>
            <a
              href="/admin/dashboard?section=cupones"
              class="nav-link flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-gray-800 transition-all duration-200 group"
              data-page="cupones"
            >
              <div
                class="w-1.5 h-1.5 rounded-full bg-gray-600 group-hover:bg-[#00aa45]"
              >
              </div>
              <span class="font-medium text-sm">Cupones</span>
            </a>
            <a
              href="/admin/dashboard?section=campanas"
              class="nav-link flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-gray-800 transition-all duration-200 group"
              data-page="campanas"
            >
              <div
                class="w-1.5 h-1.5 rounded-full bg-gray-600 group-hover:bg-[#00aa45]"
              >
              </div>
              <span class="font-medium text-sm">Campañas</span>
            </a>
          </div>

          <!-- Sistema Group -->
          <div class="pt-2 pb-2">
            <h3
              class="px-4 text-[10px] font-bold text-gray-500 uppercase tracking-[2px] mb-2"
            >
              Sistema
            </h3>
            <a
              href="/admin/dashboard?section=configuracion"
              class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-all duration-200 group"
              data-page="configuracion"
            >
              <div
                class="w-1.5 h-1.5 rounded-full bg-gray-600 group-hover:bg-[#00aa45]"
              >
              </div>
              <span class="font-medium text-sm">Configuración</span>
            </a>
          </div>
        </nav>

        <!-- User & Logout at bottom of Sidebar -->
        <div class="p-4 border-t border-gray-800 mt-auto bg-gray-900/50">
          <div class="flex flex-col gap-3">
            <button
              onclick="showLogoutModal()"
              class="flex items-center gap-3 px-4 py-3 rounded-xl bg-red-600/10 hover:bg-red-600/20 text-red-500 transition-all duration-200 group border border-red-900/20"
            >
              <svg
                class="w-5 h-5 transition-transform group-hover:scale-110"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                ></path>
              </svg>
              <span class="font-bold text-sm uppercase tracking-wider"
                >Cerrar Sesión</span
              >
            </button>
          </div>
        </div>
      </aside>

      <!-- Main Content Area -->
      <div class="flex-1 flex flex-col min-w-0 overflow-hidden">
        <!-- Top Header -->
        <header
          class="bg-gray-900 md:hidden border-b border-gray-800 shadow-sm z-[60] h-16 flex-shrink-0"
        >
          <div
            class="px-4 h-full flex justify-between items-center md:px-8 relative"
          >
            <!-- Left Side: Mobile Toggle -->
            <div class="flex items-center gap-4">
              <button
                id="menu-toggle"
                class="md:hidden p-2 hover:bg-gray-800 rounded-lg transition"
              >
                <svg
                  class="w-6 h-6 text-white"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"></path>
                </svg>
              </button>
            </div>

            <!-- Centered Branding (Only Mobile) -->
            <div
              class="md:hidden absolute left-1/2 -translate-x-1/2 flex items-center"
            >
              <span
                class="text-white font-black italic text-xl whitespace-nowrap"
                >Fashion<span class="text-[#00aa45]">Store</span></span
              >
            </div>

            <!-- Right Side (Empty but reserved for spacing) -->
            <div class="w-10 md:w-auto"></div>
          </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-auto p-4 md:p-8">
          <slot />
        </main>
      </div>
    </div>

    <!-- Modal de Logout -->
    <div
      id="logout-modal"
      class="fixed inset-0 bg-black bg-opacity-50 z-[100] hidden items-center justify-center p-4 transition-all duration-300 backdrop-blur-sm"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl max-w-md w-full transform transition-all"
      >
        <div class="p-8">
          <div class="flex justify-center mb-6">
            <div
              class="w-20 h-20 bg-red-50 rounded-full flex items-center justify-center"
            >
              <svg
                class="w-10 h-10 text-red-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                ></path>
              </svg>
            </div>
          </div>
          <h3 class="text-2xl font-bold text-gray-900 text-center mb-3">
            Cerrar Sesión
          </h3>
          <p class="text-gray-600 text-center mb-8">
            ¿Estás seguro de que deseas salir del panel de administración?
          </p>
          <div class="flex gap-4">
            <button
              onclick="closeLogoutModal()"
              class="flex-1 px-6 py-3 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold transition-all duration-200"
            >
              Cancelar
            </button>
            <button
              onclick="confirmLogout()"
              class="flex-1 px-6 py-3 rounded-xl bg-red-600 hover:bg-red-700 text-white font-bold transition-all duration-200 shadow-lg shadow-red-200"
            >
              Cerrar Sesión
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      declare global {
        interface Window {
          showLogoutModal: () => void;
          closeLogoutModal: () => void;
          confirmLogout: () => void;
          setActivePage: (pageName: string) => void;
        }
      }

      // Menú hamburguesa
      const menuToggle = document.getElementById("menu-toggle");
      const sidebar = document.getElementById("sidebar");
      const mobileOverlay = document.getElementById("mobile-overlay");

      function toggleSidebar() {
        sidebar?.classList.toggle("-translate-x-full");
        mobileOverlay?.classList.toggle("hidden");
        document.body.classList.toggle("overflow-hidden");
      }

      menuToggle?.addEventListener("click", toggleSidebar);
      mobileOverlay?.addEventListener("click", toggleSidebar);

      // Cerrar menú al hacer click en un link
      document.querySelectorAll(".nav-link").forEach((link) => {
        link.addEventListener("click", () => {
          if (window.innerWidth < 768) {
            toggleSidebar();
          }
        });
      });

      // Verificar autenticación
      document.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("admin_token");
        const username = localStorage.getItem("admin_user");

        if (!token || !username) {
          window.location.href = "/admin-secret-login";
        } else {
          // Mostrar username en sidebar y header (si hubiese)
          const userEl = document.getElementById("header-username");
          const sidebarUserEl = document.getElementById(
            "sidebar-username-display",
          );
          if (userEl) userEl.textContent = `Hola, ${username}`;
          if (sidebarUserEl) sidebarUserEl.textContent = username;
        }

        // Close modal on escape
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") closeLogoutModal();
        });

        // Funciones globales
        window.showLogoutModal = showLogoutModal;
        window.closeLogoutModal = closeLogoutModal;
        window.confirmLogout = confirmLogout;
      });

      function showLogoutModal() {
        const modal = document.getElementById("logout-modal");
        if (modal) {
          modal.classList.remove("hidden");
          modal.classList.add("flex");
        }
      }

      function closeLogoutModal() {
        const modal = document.getElementById("logout-modal");
        if (modal) {
          modal.classList.add("hidden");
          modal.classList.remove("flex");
        }
      }

      function confirmLogout() {
        localStorage.removeItem("admin_token");
        localStorage.removeItem("admin_user");
        window.location.href = "/admin-secret-login";
      }

      // Resaltar página activa
      function setActivePage(pageName: string) {
        document.querySelectorAll(".nav-link").forEach((link) => {
          link.classList.remove("bg-gray-800", "text-[#00aa45]");
          if (link.getAttribute("data-page") === pageName) {
            link.classList.add("bg-gray-800", "text-[#00aa45]");
          }
        });
      }

      window.setActivePage = setActivePage;

      // Interceptar clicks para SPA-like feel
      document.querySelectorAll(".nav-link").forEach((link) => {
        link.addEventListener("click", (e: Event) => {
          e.preventDefault();
          const href = (link as HTMLAnchorElement).getAttribute("href");
          if (href) {
            window.history.pushState({}, "", href);
            window.dispatchEvent(new Event("admin-nav-change"));

            // Get page name from href
            const url = new URL(href, window.location.origin);
            const section = url.searchParams.get("section") || "dashboard";
            setActivePage(section);
          }
        });
      });

      // Initial active state
      const initialSection =
        new URLSearchParams(window.location.search).get("section") ||
        "dashboard";
      setActivePage(initialSection);
    </script>
  </body>
</html>
