---
import "@/styles/global.css";
import NewsletterPopup from "@/components/islands/NewsletterPopup";
import EventBanner from "@/components/islands/EventBanner";
import Chatbot from "@/components/islands/Chatbot";

interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="description"
      content="FashionStore - Tienda de productos reacondicionados"
    />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>
  <body class="bg-[#f5f5f7]">
    <!-- Banner de eventos promocionales -->
    <EventBanner client:load />

    <slot />

    <!-- Popup de newsletter -->
    <NewsletterPopup client:idle delay={8000} />

    <footer class="bg-gray-900 text-white mt-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
          {/* Sobre nosotros */}
          <div>
            <h4 class="font-black italic text-lg mb-4">Sobre FashionStore</h4>
            <ul class="space-y-2 text-sm text-white">
              <li>
                <a href="/acerca" class="hover:text-[#e2ff7a]"
                  >Acerca de nosotros</a
                >
              </li>
              <li>
                <a href="/como-funciona" class="hover:text-[#e2ff7a]"
                  >Cómo funciona</a
                >
              </li>
              <li><a href="/blog" class="hover:text-[#e2ff7a]">Blog</a></li>
              <li><a href="/prensa" class="hover:text-[#e2ff7a]">Prensa</a></li>
            </ul>
          </div>

          {/* Compra */}
          <div>
            <h4 class="font-black italic text-lg mb-4">Compra</h4>
            <ul class="space-y-2 text-sm text-gray-400">
              <li>
                <a href="/productos" class="hover:text-[#e2ff7a]">Categorías</a>
              </li>
              <li>
                <a href="/productos?badge=Oferta" class="hover:text-[#e2ff7a]"
                  >Ofertas</a>
              </li>
              <li>
                <a
                  href="/productos?sort=rating-desc"
                  class="hover:text-[#e2ff7a]">Best Sellers</a>
              </li>
              <li>
                <a href="/productos?sort=date-desc" class="hover:text-[#e2ff7a]"
                  >Nuevo</a>
              </li>
            </ul>
          </div>

          {/* Ayuda */}
          <div>
            <h4 class="font-black italic text-lg mb-4">Ayuda</h4>
            <ul class="space-y-2 text-sm text-gray-400">
              <li>
                <a href="/ayuda" class="hover:text-[#e2ff7a]">Centro de ayuda</a
                >
              </li>
              <li>
                <a href="/contacto" class="hover:text-[#e2ff7a]">Contacto</a>
              </li>
              <li>
                <a href="/devoluciones" class="hover:text-[#e2ff7a]"
                  >Devoluciones</a>
              </li>
              <li>
                <a href="/preguntas-frecuentes" class="hover:text-[#e2ff7a]"
                  >Preguntas frecuentes</a
                >
              </li>
            </ul>
          </div>

          {/* Legal */}
          <div>
            <h4 class="font-black italic text-lg mb-4">Legal</h4>
            <ul class="space-y-2 text-sm text-gray-400">
              <li>
                <a href="/terminos" class="hover:text-[#e2ff7a]"
                  >Términos de servicio</a
                >
              </li>
              <li>
                <a href="/privacidad" class="hover:text-[#e2ff7a]"
                  >Privacidad</a>
              </li>
              <li>
                <a href="/cookies" class="hover:text-[#e2ff7a]">Cookies</a>
              </li>
              <li>
                <a href="/sostenibilidad" class="hover:text-[#e2ff7a]"
                  >Sostenibilidad</a
                >
              </li>
            </ul>
          </div>
        </div>

        <div
          class="border-t border-gray-800 pt-8 flex flex-col md:flex-row justify-between items-center"
        >
          <p class="text-sm text-gray-400 mb-4 md:mb-0">
            © 2026 FashionStore. Todos los derechos reservados.
          </p>
          <div class="flex gap-4">
            <a href="#" class="text-gray-400 hover:text-[#e2ff7a]">Facebook</a>
            <a href="#" class="text-gray-400 hover:text-[#e2ff7a]">Instagram</a>
            <a href="#" class="text-gray-400 hover:text-[#e2ff7a]">Twitter</a>
          </div>
        </div>
      </div>
    </footer>
    <Chatbot client:idle />
  </body>

  <script>
    // Sincronizar carrito entre localStorage y sessionStorage
    (function syncCart() {
      try {
        // Sincronizar fashionstore_guest_cart
        const cartKey = "fashionstore_guest_cart";
        const localCart = localStorage.getItem(cartKey);
        const sessionCart = sessionStorage.getItem(cartKey);

        // Si está en localStorage pero no en sessionStorage, copiar
        if (localCart && !sessionCart) {
          sessionStorage.setItem(cartKey, localCart);
          console.log(
            "[Sync] Carrito sincronizado de localStorage a sessionStorage",
          );
        }

        // Si está en sessionStorage pero no en localStorage, copiar
        if (sessionCart && !localCart) {
          localStorage.setItem(cartKey, sessionCart);
          console.log(
            "[Sync] Carrito sincronizado de sessionStorage a localStorage",
          );
        }

        // Si están en ambos, usar el más reciente
        if (localCart && sessionCart) {
          try {
            const local = JSON.parse(localCart);
            const session = JSON.parse(sessionCart);
            if (Array.isArray(local) && Array.isArray(session)) {
              if (local.length === 0 && session.length > 0) {
                localStorage.setItem(cartKey, sessionCart);
                console.log(
                  "[Sync] Usando carrito de sessionStorage (localStorage estaba vacío)",
                );
              }
            }
          } catch (e) {
            console.warn("[Sync] Error comparando carritos:", e);
          }
        }

        // Logear estado actual
        console.log("[Sync] Estado del carrito:");
        console.log(
          "- localStorage:",
          localCart ? `${JSON.parse(localCart).length} items` : "vacío",
        );
        console.log(
          "- sessionStorage:",
          sessionCart ? `${JSON.parse(sessionCart).length} items` : "vacío",
        );
      } catch (error) {
        console.error("[Sync] Error sincronizando carrito:", error);
      }
    })();
  </script>
</html>

<style is:global>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    font-family: system-ui, sans-serif;
    background-color: #f5f5f7;
  }

  body {
    background-color: #f5f5f7;
  }
</style>
