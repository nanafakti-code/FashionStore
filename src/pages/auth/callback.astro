---
import Layout from "@/layouts/Layout.astro";

// Esta página maneja el callback de OAuth desde Google y Apple
// Supabase redirige aquí después de la autenticación
---

<Layout title="Completando inicio de sesión...">
  <div class="flex items-center justify-center min-h-screen bg-[#f5f5f7]">
    <div class="text-center">
      <div class="inline-block">
        <div class="w-16 h-16 border-4 border-[#e2ff7a] border-t-[#00aa45] rounded-full animate-spin mb-4"></div>
      </div>
      <h1 class="text-3xl font-black italic text-gray-900 mb-2">
        Completando inicio de sesión...
      </h1>
      <p class="text-gray-600">
        Por favor espera mientras procesamos tu autenticación.
      </p>
      <p class="text-sm text-gray-500 mt-4">
        Si esto tarda más de unos segundos, <a href="/" class="text-[#00aa45] hover:underline">regresa al inicio</a>.
      </p>
    </div>
  </div>

  <script is:inline>
    // Esperar a que Supabase procese el callback
    setTimeout(async () => {
      // Importar la función de migración del carrito
      try {
        const { migrateLocalCartToDatabase } = await import("@/lib/cartMigration");
        await migrateLocalCartToDatabase();
      } catch (error) {
        console.error("Error migrating cart:", error);
      }

      // Redirigir al inicio después de que se procese
      window.location.href = "/";
    }, 2000);
  </script>
</Layout>
