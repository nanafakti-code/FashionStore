---
// Admin Setup Page - Developer Helper
// Solo disponible en modo desarrollo
import Layout from "@/layouts/Layout.astro";

if (!import.meta.env.DEV) {
  return new Response('Not Found', { status: 404 });
}
---

<Layout title="Admin Setup - FashionStore">
  <main class="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 py-12 px-4">
    <div class="max-w-2xl mx-auto">
      <div class="bg-white rounded-2xl shadow-2xl p-8">
        <div class="text-center mb-8">
          <h1 class="text-4xl font-black text-gray-900 mb-2">Admin Setup</h1>
          <p class="text-gray-600">Inicializaci√≥n de credenciales administrativas</p>
        </div>

        <div class="bg-blue-50 border-2 border-blue-400 rounded-xl p-6 mb-6">
          <h2 class="font-bold text-blue-900 mb-3">‚öôÔ∏è Paso 1: Inicializar Credenciales</h2>
          <p class="text-blue-800 text-sm mb-4">
            Este bot√≥n crear√° el usuario admin con las siguientes credenciales:
          </p>
          <div class="bg-white p-4 rounded-lg mb-4 font-mono text-sm border border-blue-200">
            <div><strong>Email:</strong> admin@fashionstore.com</div>
            <div><strong>Contrase√±a:</strong> 1234</div>
          </div>
          <button
            id="init-btn"
            class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors"
          >
            üîß Inicializar Admin
          </button>
        </div>

        <div id="result" class="hidden"></div>

        <div class="bg-green-50 border-2 border-green-400 rounded-xl p-6">
          <h2 class="font-bold text-green-900 mb-3">‚úÖ Paso 2: Acceder al Panel</h2>
          <p class="text-green-800 text-sm mb-4">
            Una vez inicializado, ve a:
          </p>
          <a
            href="/admin-secret-login"
            class="inline-block bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors"
          >
            Ir a Login Admin ‚Üí
          </a>
        </div>
      </div>
    </div>
  </main>

  <script is:inline>
    document.getElementById("init-btn").addEventListener("click", async () => {
      const btn = document.getElementById("init-btn");
      const resultDiv = document.getElementById("result");
      
      btn.disabled = true;
      btn.textContent = "Inicializando...";
      
      try {
        const response = await fetch("/api/admin/init", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "create" }),
        });

        const data = await response.json();

        if (response.ok) {
          resultDiv.className = "bg-green-100 border-2 border-green-500 rounded-xl p-6 mb-6";
          resultDiv.innerHTML = `
            <h3 class="font-bold text-green-900 mb-3">‚úÖ ¬°Inicializaci√≥n Exitosa!</h3>
            <p class="text-green-800 mb-3">${data.message}</p>
            <div class="bg-white p-4 rounded-lg font-mono text-sm border border-green-300">
              <div><strong>Email:</strong> ${data.email}</div>
              <div><strong>Contrase√±a:</strong> ${data.password}</div>
            </div>
            <a href="/admin-secret-login" class="inline-block mt-6 bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700">
              Ir a Login Admin ‚Üí
            </a>
          `;
          resultDiv.classList.remove("hidden");
        } else {
          resultDiv.className = "bg-red-100 border-2 border-red-500 rounded-xl p-6 mb-6";
          resultDiv.innerHTML = `
            <h3 class="font-bold text-red-900 mb-2">‚ùå Error</h3>
            <p class="text-red-800">${data.error || "Error desconocido"}</p>
          `;
          resultDiv.classList.remove("hidden");
        }
      } catch (error) {
        resultDiv.className = "bg-red-100 border-2 border-red-500 rounded-xl p-6 mb-6";
        resultDiv.innerHTML = `
          <h3 class="font-bold text-red-900 mb-2">‚ùå Error de Red</h3>
          <p class="text-red-800">${error.message}</p>
        `;
        resultDiv.classList.remove("hidden");
      } finally {
        btn.disabled = false;
        btn.textContent = "üîß Inicializar Admin";
      }
    });
  </script>
</Layout>
